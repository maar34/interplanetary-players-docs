<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: MIDIController.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-MIDIControllers.html">MIDIControllers</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="DataManager.html">DataManager</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="MIDI.html">MIDI</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#MIDI_SUPPORTED">MIDI_SUPPORTED</a></div><div class="sidebar-section-children"><a href="global.html#_setValue">_setValue</a></div><div class="sidebar-section-children"><a href="global.html#activateRadio">activateRadio</a></div><div class="sidebar-section-children"><a href="global.html#addEventListeners">addEventListeners</a></div><div class="sidebar-section-children"><a href="global.html#animate">animate</a></div><div class="sidebar-section-children"><a href="global.html#applyColorsFromTrackData">applyColorsFromTrackData</a></div><div class="sidebar-section-children"><a href="global.html#cycleState">cycleState</a></div><div class="sidebar-section-children"><a href="global.html#drawKnob">drawKnob</a></div><div class="sidebar-section-children"><a href="global.html#drawModeIndicator">drawModeIndicator</a></div><div class="sidebar-section-children"><a href="global.html#drawSlider">drawSlider</a></div><div class="sidebar-section-children"><a href="global.html#drawSwitch">drawSwitch</a></div><div class="sidebar-section-children"><a href="global.html#forward">forward</a></div><div class="sidebar-section-children"><a href="global.html#getPriority">getPriority</a></div><div class="sidebar-section-children"><a href="global.html#handleParamChange">handleParamChange</a></div><div class="sidebar-section-children"><a href="global.html#hidetip">hidetip</a></div><div class="sidebar-section-children"><a href="global.html#initializeApp">initializeApp</a></div><div class="sidebar-section-children"><a href="global.html#initializeAttributes">initializeAttributes</a></div><div class="sidebar-section-children"><a href="global.html#initializeRootParams">initializeRootParams</a></div><div class="sidebar-section-children"><a href="global.html#inverse">inverse</a></div><div class="sidebar-section-children"><a href="global.html#isActive">isActive</a></div><div class="sidebar-section-children"><a href="global.html#keydown">keydown</a></div><div class="sidebar-section-children"><a href="global.html#linear">linear</a></div><div class="sidebar-section-children"><a href="global.html#loadAndDisplayModel">loadAndDisplayModel</a></div><div class="sidebar-section-children"><a href="global.html#loadGLBModelWithRetry">loadGLBModelWithRetry</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#piecewiseLinear">piecewiseLinear</a></div><div class="sidebar-section-children"><a href="global.html#pointerdown">pointerdown</a></div><div class="sidebar-section-children"><a href="global.html#pointermove">pointermove</a></div><div class="sidebar-section-children"><a href="global.html#pointerup">pointerup</a></div><div class="sidebar-section-children"><a href="global.html#processColors">processColors</a></div><div class="sidebar-section-children"><a href="global.html#redraw">redraw</a></div><div class="sidebar-section-children"><a href="global.html#registerMenuItemsWithMIDIController">registerMenuItemsWithMIDIController</a></div><div class="sidebar-section-children"><a href="global.html#removeEventListeners">removeEventListeners</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setupCanvas">setupCanvas</a></div><div class="sidebar-section-children"><a href="global.html#setupCollapseMenuAlignment">setupCollapseMenuAlignment</a></div><div class="sidebar-section-children"><a href="global.html#setupInteractions">setupInteractions</a></div><div class="sidebar-section-children"><a href="global.html#setupLabel">setupLabel</a></div><div class="sidebar-section-children"><a href="global.html#setupResizeObserver">setupResizeObserver</a></div><div class="sidebar-section-children"><a href="global.html#showParameterSelectionModal">showParameterSelectionModal</a></div><div class="sidebar-section-children"><a href="global.html#showUniversalModal">showUniversalModal</a></div><div class="sidebar-section-children"><a href="global.html#showtip">showtip</a></div><div class="sidebar-section-children"><a href="global.html#toggleState">toggleState</a></div><div class="sidebar-section-children"><a href="global.html#triggerKick">triggerKick</a></div><div class="sidebar-section-children"><a href="global.html#updateKnobsFromTrackData">updateKnobsFromTrackData</a></div><div class="sidebar-section-children"><a href="global.html#updateLinkedParam">updateLinkedParam</a></div><div class="sidebar-section-children"><a href="global.html#updateTooltip">updateTooltip</a></div><div class="sidebar-section-children"><a href="global.html#updateValueFromPointer">updateValueFromPointer</a></div><div class="sidebar-section-children"><a href="global.html#updateValueFromPointerRel">updateValueFromPointerRel</a></div><div class="sidebar-section-children"><a href="global.html#validateValue">validateValue</a></div><div class="sidebar-section-children"><a href="global.html#wheel">wheel</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">MIDIController.js</h1></header><article><pre class="prettyprint source lang-js"><code>// MIDIController.js
/**
 * @namespace MIDI
 */
/**
 * Represents a MIDI Device.
 * @memberof MIDI
 */
/**
 * @module MIDIControllers
 * @description Handles all MIDI controller-related logic.
 */

/**
 * 
 * 
 * MIDIController Singleton Class
 * Handles MIDI interactions, including listening to MIDI inputs,
 * managing MIDI mappings, and facilitating MIDI Learn functionality.
 */

import { Constants, getPriority, MIDI_SUPPORTED } from './Constants.js';
import lscache from 'lscache';
import { showUniversalModal } from './Interaction.js';
import { ButtonGroup } from './ButtonGroup.js';
import { notifications } from './Main.js';

class MIDIController {
  constructor() {
    if (MIDIController.instance) {
      return MIDIController.instance;
    }

    this.midiAccess = null;

    // Separate mappings for parameters and widgets
    this.midiParamMappings = new Map(); // parameterName -> { channel, cc }
    this.midiWidgetMappings = new Map(); // widgetId -> { channel, cc }

    this.widgetRegistry = new Map(); // widgetId -> widgetInstance

    this.isMIDIActivated = false;

    this.isMidiLearnModeActive = false;
    this.currentLearnParam = null;
    this.currentLearnWidget = null;

    // Bind methods to maintain 'this' context
    this.handleMidiMessage = this.handleMidiMessage.bind(this);
    this.handleStateChange = this.handleStateChange.bind(this);
    this.handleExitButtonClick = this.handleExitButtonClick.bind(this);
    this.handleEscKey = this.handleEscKey.bind(this);
    this.handleContextMenuLearn = this.handleContextMenuLearn.bind(this);
    this.handleContextMenuDelete = this.handleContextMenuDelete.bind(this);
    this.handleContextMenuClose = this.handleContextMenuClose.bind(this);
    this.highlightParameter = this.highlightParameter.bind(this);
    this.unhighlightParameter = this.unhighlightParameter.bind(this);
    this.highlightWidget = this.highlightWidget.bind(this);
    this.unhighlightWidget = this.unhighlightWidget.bind(this);
    this.startMidiLearnForWidget = this.startMidiLearnForWidget.bind(this);
    this.closeContextMenu = this.closeContextMenu.bind(this); // Existing method

    this.init();

    MIDIController.instance = this;
  }


  async init() {
    if (!MIDI_SUPPORTED) {
      console.warn("MIDIController: Web MIDI API not supported. Skipping initialization.");
      return;
    }

    notifications.showToast("MIDIController: Web MIDI API supported.");
    // Restore persisted mappings if you have this method
    // await this.restoreMidiLearn();

    // Set up the exit button for MIDI Learn mode
    const exitButton = document.getElementById('exit-midi-learn');
    if (exitButton) {
      exitButton.addEventListener('click', this.handleExitButtonClick);
    }

    // Set up event listeners for the context menu options
    this.setupDropdownEventListeners();
  }

  /**
   * Activates MIDI mode with custom modal messaging.
   * Shows the modal only on the first successful activation.
   */
  async activateMIDI() {
    if (this.isMIDIActivated) {
        notifications.showToast('MIDI is already activated.', 'info');
        return;
    }

    try {
        await this.requestMidiAccess();
        this.isMIDIActivated = true;
        notifications.showToast('MIDI activated successfully!', 'success');
    } catch (error) {
        notifications.showToast(`MIDI activation failed: ${error.message}`, 'error'); // THIS ERROR 
    }
}

/**
 * Requests MIDI access and initializes inputs with better iteration and state handling.
 */
async requestMidiAccess() {
  if (!('requestMIDIAccess' in navigator)) {
    notifications.showToast('Web MIDI API not supported in this environment.', 'error');
    throw new Error('Web MIDI API not supported');
  }

  try {
    // Request MIDI access
    this.midiAccess = await navigator.requestMIDIAccess({ sysex: false });
    notifications.showToast('MIDI access granted. Checking inputs...', 'success');

    // Log available inputs for debugging
    console.log('Initial MIDI Inputs:', Array.from(this.midiAccess.inputs.values()));

    // Listen for state changes (e.g., devices being connected or disconnected)
    this.midiAccess.onstatechange = this.handleStateChange.bind(this);

    // Enable inputs dynamically
    this.enableInputs();
  } catch (error) {
    notifications.showToast(`Failed to access MIDI: ${error.message}`, 'error');
    console.error('MIDI Access Error:', error);
    throw error;
  }
}

/**
 * Enables MIDI inputs and binds the message handlers.
 */
enableInputs() {
  if (!this.midiAccess) {
    notifications.showToast('MIDI access is not initialized. Cannot enable inputs.', 'error');
    return;
  }

  // Use the iterator to process MIDI inputs dynamically
  const inputs = this.midiAccess.inputs.values();
  let hasInputs = false;

  for (let input = inputs.next(); input &amp;&amp; !input.done; input = inputs.next()) {
    hasInputs = true;
    input.value.onmidimessage = this.handleMidiMessage.bind(this);
    notifications.showToast(`Enabled MIDI input: ${input.value.name}`, 'info');
    console.log(`Connected MIDI input: ${input.value.name}`);
  }

  if (!hasInputs) {
    notifications.showToast('No MIDI inputs found. Please connect a MIDI device.', 'warning');
    console.log('No MIDI inputs available.');
  }
}

/**
 * Handles state changes for MIDI devices (e.g., connected/disconnected).
 * @param {MIDIConnectionEvent} event
 */
handleStateChange(event) {
  const port = event.port;

  notifications.showToast(`MIDI device ${port.name} is now ${port.state}.`, 'info');

  if (port.type === 'input') {
    if (port.state === 'connected') {
      port.onmidimessage = this.handleMidiMessage.bind(this);
      notifications.showToast(`Connected to MIDI input: ${port.name}`, 'success');
      console.log(`Connected to MIDI input: ${port.name}`);
    } else if (port.state === 'disconnected') {
      port.onmidimessage = null;
      notifications.showToast(`Disconnected from MIDI input: ${port.name}`, 'warning');
      console.log(`Disconnected from MIDI input: ${port.name}`);
    }
  }
}

  /**
   * Handles incoming MIDI messages and dispatches them to widgets or parameters.
   * If in MIDI Learn mode, maps the incoming CC to the selected parameter or widget.
   * @param {MIDIMessageEvent} event 
   */

  handleMidiMessage(event) {
    const [status, data1, data2] = event.data;
    const channel = status &amp; 0x0F;
    const messageType = status &amp; 0xF0;

    // Process only Control Change (CC) messages
    if (messageType !== 0xB0) return;

    // MIDI Learn Mode: Map MIDI input to a widget
    if (this.isMidiLearnModeActive &amp;&amp; this.currentLearnWidget) {
        const widgetId = this.currentLearnWidget.id || this.currentLearnWidget.getAttribute('data-value');
        console.log(`Mapping widget '${widgetId}' to MIDI Channel ${channel + 1}, CC ${data1}`);
        this.setMidiWidgetMapping(widgetId, channel, data1);

        // Update feedback and reset learning
        this.unhighlightWidget(widgetId);
        this.markAsMapped(widgetId, data1, channel);
        //notifications.showToast(`Assigned CC ${data1} to '${widgetId}'.`, 'success');
        this.currentLearnWidget = null;
        return; // Exit after mapping
    }

    // Process mapped widgets
    this.midiWidgetMappings.forEach((mapping, widgetId) => {
        if (mapping.channel === channel &amp;&amp; mapping.cc === data1) {
            const widget = this.widgetRegistry.get(widgetId);

            if (!widget) {
                console.warn(`Widget '${widgetId}' not found.`);
                return;
            }

            // Dropdown Item Handling
            if (widget.classList.contains('dropdown-item')) {
                 widget.click();
            } 
            // WebAudioSwitch Handling
            else if (widget instanceof HTMLElement &amp;&amp; widget.tagName === 'WEBAUDIO-SWITCH') {
                this.triggerWebAudioSwitch(widget, data2);
            } 
            // Standard Widget Handling (e.g., sliders)
            else {
                this.updateWebAudioWidget(widget, data2);
            }
        }
    });

    // Update Parameters
    this.midiParamMappings.forEach((mapping, param) => {
        if (mapping.channel === channel &amp;&amp; mapping.cc === data1) {
            this.updateParameter(param, data2);
        }
    });
}

/**
 * Updates standard widgets like sliders.
 * @param {HTMLElement} widget - The widget element.
 * @param {number} value - The MIDI value (0-127).
 */
updateWebAudioWidget(widget, value) {
  const normalizedValue = value / 127;

  // Use _min and _max if available, otherwise fall back to min and max
  const min = widget._min !== undefined ? widget._min : widget.min;
  const max = widget._max !== undefined ? widget._max : widget.max;

  if (min === undefined || max === undefined) {
      console.warn(`Widget '${widget.id}' is missing min/max values.`);
      return;
  }

  // Calculate the new value based on normalization
  widget.value = min + normalizedValue * (max - min);

}



/**
 * Triggers WebAudioSwitch actions or invokes dropdown item actions.
 * @param {HTMLElement} widget - The widget element.
 * @param {number} value - The MIDI value (0-127).
 */
triggerWebAudioSwitch(widget, value) {
    if (widget.tagName.toLowerCase() === 'a' &amp;&amp; widget.classList.contains('dropdown-item')) {
        console.log(`MIDIController: Triggering dropdown item '${widget.id}'`);
        if (typeof widget.onclick === 'function') {
            widget.onclick(); // Invoke dropdown action
        } else {
            console.warn(`Dropdown item '${widget.id}' has no onclick handler.`);
        }
    } else if (widget.type === 'toggle') {
        widget.setState(value > 0 ? 1 : 0, true); // Fire events
    } else if (widget.type === 'kick') {
        widget.triggerKick(); // Simulate kick
    } else if (widget.type === 'sequential') {
        const delta = value > 64 ? 1 : -1;
        widget.cycleState(delta); // Cycle state
    } else if (widget.type === 'radio') {
        widget.activateRadio(); // Activate radio
    } else {
        widget.setValue(value / 127, true); // Update knobs or sliders
    }

      // Redraw the widget if a redraw method is available
    widget.redraw();



}
  markAsMapped(elementId, midiCC, midiChannel) {
    const element = document.getElementById(elementId) || document.querySelector(`[data-value="${elementId}"]`);
    if (element) {
      // Change highlight class
      element.classList.remove('midi-learn-highlight');
      element.classList.add('midi-mapped');

      // Remove existing indicator if any
      let indicator = document.querySelector(`.midi-indicator[data-element-id="${elementId}"]`);
      if (indicator) {
        indicator.remove();
      }

      // Add MIDI controller indicator
      indicator = document.createElement('div');
      indicator.className = 'midi-indicator';
      indicator.dataset.elementId = elementId;
      indicator.textContent = `CH ${midiChannel + 1} / CC ${midiCC}`;
      document.body.appendChild(indicator);

      // Position the indicator over the element
      const rect = element.getBoundingClientRect();
      indicator.style.position = 'fixed';
      indicator.style.left = `${rect.right - 30}px`; // Adjust as needed
      indicator.style.top = `${rect.bottom - 20}px`; // Adjust as needed
      indicator.style.zIndex = '1002';
    }
  }

  /**
   * Updates a parameter based on incoming MIDI data.
   * @param {string} widgetId - The widget's unique ID.
   * @param {number} midiValue - The MIDI CC value (0-127).
   */
  updateParameter(identifier, midiValue) {
    const element = this.widgetRegistry.get(identifier);
    if (element) {
      if (element.tagName.toLowerCase() === 'a' &amp;&amp; element.classList.contains('dropdown-item')) {
        // Directly invoke the associated action without simulating a click
        console.log(`MIDIController: Invoking action for dropdown item '${identifier}'`);
        if (typeof element.onclick === 'function') {
          element.onclick(); // Invoke the existing click handler directly
        } else {
          console.warn(`MIDIController: No onclick handler defined for dropdown item '${identifier}'.`);
        }
      } else {
        // Handle widgets
        const widget = element;
        const normalizedValue = midiValue / 127; // Normalize to [0, 1]
        widget.value = widget.min + normalizedValue * (widget.max - widget.min);
        if (typeof widget.redraw === 'function') {
          widget.redraw(); // Ensure the widget updates its display
        }
        console.log(`MIDIController: Updated widget '${identifier}' to value ${widget.value}`);
      }
    } else {
      console.warn(`MIDIController: Element '${identifier}' not found.`);
    }
  }

  /**
   * Registers a widget for MIDI control.
   * @param {string} id - The widget's unique ID.
   * @param {Object} widget - The widget instance.
   */
  registerWidget(id, widget) {
    if (!id || !widget) {
      console.warn("MIDIController: Cannot register widget without ID or instance.");
      return;
    }
    this.widgetRegistry.set(id, widget);
  }

  /**
   * Sets a MIDI mapping for a parameter.
   * @param {string} param - The parameter name.
   * @param {number} channel - MIDI channel (0-15).
   * @param {number} cc - MIDI Control Change number (0-127).
   */
/*   setMidiParamMapping(param, channel, cc) {
    if (!param) {
      console.warn("MIDIController: Parameter name is required for mapping.");
      return;
    }

    this.midiParamMappings.set(param, { channel, cc });
    console.log(`MIDIController: Mapped parameter '${param}' to MIDI Channel ${channel + 1}, CC ${cc}.`);

    // Add 'midi-mapped' class to the parameter element for visual indication
    const paramElement = document.querySelector(`[data-group="${param}"]`);
    if (paramElement) {
      paramElement.classList.add('midi-mapped');
    }
  } */

  /**
   * Sets a MIDI mapping for a widget.
   * @param {string} widgetId - The widget's unique ID.
   * @param {number} channel - MIDI channel (0-15).
   * @param {number} cc - MIDI Control Change number (0-127).
   */
  setMidiWidgetMapping(widgetId, channel, cc) {
    if (!widgetId) {
      console.warn("MIDIController: Widget ID is required for mapping.");
      return;
    }

    this.midiWidgetMappings.set(widgetId, { channel, cc });
    console.log(`MIDIController: Mapped widget '${widgetId}' to MIDI Channel ${channel + 1}, CC ${cc}.`);

    // Add 'midi-mapped' class to the widget element for visual indication
    const widgetElement = document.getElementById(widgetId);
    if (widgetElement) {
      widgetElement.classList.add('midi-mapped');
    }
  }

  /**
   * Clears the MIDI mapping for a specific parameter or widget.
   * @param {string} identifier - The parameter name or widget ID.
   */
  clearMidiMapping(identifier) {
    let cleared = false;
  
    // Check if identifier is a parameter
    if (this.midiParamMappings.has(identifier)) {
      this.midiParamMappings.delete(identifier);
      cleared = true;
  
      // Remove 'midi-mapped' class from the parameter element
      const paramElement = document.querySelector(`[data-group="${identifier}"]`);
      if (paramElement) {
        paramElement.classList.remove('midi-mapped');
      }
  
      // Remove MIDI indicator
      const indicator = document.querySelector(`.midi-indicator[data-element-id="${identifier}"]`);
      if (indicator) {
        indicator.remove();
      }
  
      console.log(`MIDIController: Cleared MIDI mapping for parameter '${identifier}'.`);
    }
  
    // Check if identifier is a widget
    if (this.midiWidgetMappings.has(identifier)) {
      this.midiWidgetMappings.delete(identifier);
      cleared = true;
  
      // Remove 'midi-mapped' class from the widget element
      const widgetElement = document.getElementById(identifier) || document.querySelector(`[data-value="${identifier}"]`);
      if (widgetElement) {
        widgetElement.classList.remove('midi-mapped');
      }
  
      // Remove MIDI indicator
      const indicator = document.querySelector(`.midi-indicator[data-element-id="${identifier}"]`);
      if (indicator) {
        indicator.remove();
      }
  
      console.log(`MIDIController: Cleared MIDI mapping for widget '${identifier}'.`);
    }
  
    if (cleared) {
      // Notify the user
      notifications.showToast(`Cleared MIDI mapping for '${identifier}'.`, 'success');
    } else {
      console.warn(`MIDIController: No MIDI mapping found for '${identifier}'.`);
      notifications.showToast(`No MIDI mapping exists for '${identifier}'.`, 'error');
    }
  }

  /**
   * Enables MIDI Learn mode by creating overlays over automatable elements.
   */
  enableMidiLearn() {
    if (!this.isMIDIActivated) {
      notifications.showToast('MIDIController: MIDI is not activated. Cannot enter MIDI Learn mode.');
      return;
    }
    notifications.showToast('MIDIController: Entering MIDI Learn mode...');
  
    this.isMidiLearnModeActive = true;
    this.currentLearnParam = null;
    this.currentLearnWidget = null;
  
    // Create overlays for automatable widgets and dropdown items
    this.createOverlays();
    this.toggleMoreMenuButton(true); // Update button

    // Add class to body for CSS control
    document.body.classList.add('midi-learn-mode');
  
    // Listen for Esc key to exit
    document.addEventListener('keydown', this.handleEscKey);
  
    // Display a toast message indicating MIDI Learn mode is active
    notifications.showToast('MIDI Learn mode activated. Click on a control to assign MIDI.', 'info');
  }

  /**
   * Creates overlays over automatable elements during MIDI Learn mode.
   */
  createOverlays() {
    // Handle widgets (sliders, knobs, buttons)
    const widgets = document.querySelectorAll('[data-automatable="true"]');
    widgets.forEach(widget => {
      const id = widget.id;
      if (!id) {
        console.warn("MIDIController: Widget missing 'id' attribute:", widget);
        return;
      }
  
      const overlay = document.createElement('div');
      overlay.classList.add('widget-overlay');
      overlay.dataset.widgetId = id;
  
      const rect = widget.getBoundingClientRect();
      overlay.style.position = 'fixed';
      overlay.style.top = `${rect.top}px`;
      overlay.style.left = `${rect.left}px`;
      overlay.style.width = `${rect.width}px`;
      overlay.style.height = `${rect.height}px`;
      overlay.style.pointerEvents = 'auto';
      overlay.style.zIndex = '1000';
      overlay.style.background = 'rgba(255, 255, 255, 0.1)'; // Optional: Semi-transparent overlay
  
      overlay.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation(); // prevent event bubbling
  
        const isMapped = this.isElementMapped(widget);
        if (isMapped) {
          this.openContextMenu(e, widget);
        } else {
          this.startMidiLearnForElement(widget);
        }
      });
      document.body.appendChild(overlay);
    });
  
    // Handle drop-down items (menu items)
    const dropdownItems = document.querySelectorAll('[data-midi-controllable="true"]');
    dropdownItems.forEach(item => {
      item.classList.add('midi-learn-dropdown');
  
      // Store original click handler
      if (!item.originalClickHandler) {
        item.originalClickHandler = item.onclick;
        item.onclick = null;
      }
  
      // Bind the event handler
      item.dropdownItemClickHandler = (e) => {
        if (!this.isMidiLearnModeActive) {
            console.warn('MIDIController: Ignored click outside MIDI Learn mode.');
            return; // Ignore if not in MIDI Learn mode
        }
    

        e.preventDefault();
        e.stopPropagation();
  
        const isMapped = this.isElementMapped(item);
        if (isMapped) {
          this.openContextMenu(e, item);
        } else {
          this.startMidiLearnForElement(item);
        }
      };
  
      item.addEventListener('click', item.dropdownItemClickHandler);
    });
  
    console.log('MIDIController: Created overlays for automatable widgets and dropdown items.');
  }

  /**
   * Removes overlays created during MIDI Learn mode.
   */
  removeOverlays() {
    console.log('MIDIController: Executing removeOverlays');

    // Remove widget overlays
    const overlays = document.querySelectorAll('.widget-overlay');
    overlays.forEach(overlay => {
        overlay.parentNode.removeChild(overlay);
    });

    // Restore dropdown items
    const dropdownItems = document.querySelectorAll('[data-midi-controllable="true"]');
    dropdownItems.forEach(item => {
        item.classList.remove('midi-learn-dropdown');

        // Remove custom event listener
        if (item.dropdownItemClickHandler) {
            item.removeEventListener('click', item.dropdownItemClickHandler);
            delete item.dropdownItemClickHandler;
        }

        // Restore original click handler
        if (item.originalClickHandler) {
            item.onclick = item.originalClickHandler;
            delete item.originalClickHandler;
        }

    });

}

  /**
   * Initiates MIDI learning mode for a specific widget.
   * @param {HTMLElement} widget 
   */
  startMidiLearnForWidget(widget) {
    if (!widget.id) {
      console.warn("MIDIController: Widget missing 'id' attribute.");
      return;
    }
  
    this.currentLearnWidget = widget;
    this.isMidiLearnModeActive = true;
  
    console.log(`MIDIController: MIDI Learn mode activated for widget '${widget.id}'.`);
  
    // Highlight the widget for user feedback
    this.highlightWidget(widget.id);
  
    // Display a toast message instead of a modal
    notifications.showToast(`Perform a MIDI action to assign it to '${widget.id}'.`, 'info');
  }

  /**
   * Highlights a specific widget in the UI to indicate it's being mapped.
   * @param {string} widgetId - The widget's unique ID.
   */
  highlightWidget(widgetId) {
    const element = document.getElementById(widgetId);
    if (element) {
      element.classList.add('midi-learn-highlight');
      console.log(`MIDIController: Highlighted widget '${widgetId}' for MIDI Learn.`);
    }
  }

  /**
   * Removes the highlight from a specific widget in the UI.
   * @param {string} widgetId - The widget's unique ID.
   */
  unhighlightWidget(widgetId) {
    const element = document.getElementById(widgetId);
    if (element) {
      element.classList.remove('midi-learn-highlight');
      console.log(`MIDIController: Removed highlight from widget '${widgetId}'.`);
    }
  }

  /**
   * Highlights a specific parameter in the UI to indicate it's being mapped.
   * @param {string} param - The parameter name.
   */
  highlightParameter(param) {
    const element = document.querySelector(`[data-group="${param}"]`);
    if (element) {
      element.classList.add('midi-learn-highlight');
      console.log(`MIDIController: Highlighted parameter '${param}' for MIDI Learn.`);
    }
  }

  /**
   * Removes the highlight from a specific parameter in the UI.
   * @param {string} param - The parameter name.
   */
  unhighlightParameter(param) {
    const element = document.querySelector(`[data-group="${param}"]`);
    if (element) {
      element.classList.remove('midi-learn-highlight');
      console.log(`MIDIController: Removed highlight from parameter '${param}'.`);
    }
  }

  /**
   * Handles the "Cancel MIDI Learn" button click.
   */
  handleExitButtonClick() {
    this.exitMidiLearnMode();
  }
// Function to toggle the button in MIDI Learn Mode
toggleMoreMenuButton(isMidiLearnModeActive) {
  const moreButton = document.getElementById('moreMenuButton');

  if (!moreButton) {
      console.error('MIDIController: More Menu Button not found.');
      return;
  }

  const buttonIcon = moreButton.querySelector('.button-icon');
  if (!buttonIcon) {
      console.error('MIDIController: Button icon not found inside More Menu Button.');
      return;
  }

  const newIconSrc = isMidiLearnModeActive
      ? '/assets/icons/close-dinamic.svg'
      : '/assets/icons/more.svg';
  const newLabel = isMidiLearnModeActive
      ? 'Exit MIDI Learn Mode'
      : 'More options';

  // Update the button attributes
  moreButton.setAttribute('aria-label', newLabel);

  // Add or remove the 'close-mode' class dynamically
  if (isMidiLearnModeActive) {
      moreButton.classList.add('close-mode'); // Apply close styling
      moreButton.removeAttribute('data-bs-toggle'); // Disable dropdown
      moreButton.onclick = () => this.exitMidiLearnMode(); // Add exit functionality
  } else {
      moreButton.classList.remove('close-mode'); // Revert to default styling
      moreButton.setAttribute('data-bs-toggle', 'dropdown'); // Enable dropdown
      moreButton.onclick = null; // Clear custom click handler
  }

  // Dynamically update the button icon
  this.fetchAndSetSVG(newIconSrc, buttonIcon, true);
}

    /**
     * Fetch and set SVG content.
     */
    fetchAndSetSVG(src, element, isInline = true) {
      if (!isInline) return;

      fetch(src)
          .then(response => {
              if (!response.ok) throw new Error(`Failed to load SVG: ${src}`);
              return response.text();
          })
          .then(svgContent => {
              const parser = new DOMParser();
              const svgDoc = parser.parseFromString(svgContent, 'image/svg+xml');
              const svgElement = svgDoc.documentElement;

              if (svgElement &amp;&amp; svgElement.tagName.toLowerCase() === 'svg') {
                  svgElement.setAttribute('fill', 'currentColor');
                  svgElement.setAttribute('role', 'img');
                  svgElement.classList.add('icon-svg');
                  element.innerHTML = '';
                  element.appendChild(svgElement);
              } else {
                  console.error(`Invalid SVG content fetched from: ${src}`);
              }
          })
          .catch(error => console.error(`Error loading SVG from ${src}:`, error));
  }
  
  /**
   * Handles the Esc key press to exit MIDI Learn mode.
   * @param {KeyboardEvent} e 
   */
  handleEscKey(e) {
    if (e.key === 'Escape' &amp;&amp; this.isMidiLearnModeActive) {
      this.exitMidiLearnMode();
    }
  }

  /**
   * Exits MIDI Learn mode by removing overlays and hiding the exit button.
   */
  exitMidiLearnMode() {
    console.log('MIDIController: Exiting MIDI Learn mode.');

    // Update the mode state
    this.isMidiLearnModeActive = false;
    this.currentLearnParam = null;
    this.currentLearnWidget = null;

    // Remove mode-specific body class
    document.body.classList.remove('midi-learn-mode');
    // Close context menu if open
    this.closeContextMenu();
    // Remove overlays
    this.removeOverlays();
    this.toggleMoreMenuButton(false); // Revert button

    // Remove all highlights
    const highlightedElements = document.querySelectorAll('.midi-learn-highlight');
    highlightedElements.forEach(element => {
        element.classList.remove('midi-learn-highlight');
    });


    // Close context menu if open
    this.closeContextMenu();

    // Remove lingering messages
    const toastContainer = document.getElementById('toast-container');
    if (toastContainer) {
        toastContainer.innerHTML = '';
    }

    // Remove Esc key listener
    document.removeEventListener('keydown', this.handleEscKey);

    // Reset the MIDI Learn icon
    const midiIcon = document.getElementById('midi-learn-icon');
    if (midiIcon) {
        midiIcon.classList.remove('active');
        midiIcon.classList.add('default');
        midiIcon.setAttribute('aria-label', 'Jam Mode');
    }

    console.log('MIDIController: Fully exited MIDI Learn mode.');
}
  
  /**
   * Handles the "Learn" action from the context menu.
   * Initiates MIDI Learn mode for the selected parameter or widget.
   * @param {Event} event 
   */
  handleContextMenuLearn(event) {
    console.log('handleContextMenuLearn called');
    // Prevent default behavior and stop propagation
    event.preventDefault();
    event.stopPropagation();

    if (this.currentlyLearningWidget) {
      const widgetId = this.currentlyLearningWidget.id;
      if (!widgetId) {
        console.warn("MIDIController: Selected widget does not have a valid 'id' attribute.");
        return;
      }

      // Initiate MIDI Learn for the widget
      this.startMidiLearnForWidget(this.currentlyLearningWidget);
    } else if (this.currentLearnParam) {
      // Initiate MIDI Learn for the parameter
      this.isMidiLearnModeActive = true;
      console.log(`MIDIController: MIDI Learn mode activated for parameter '${this.currentLearnParam}'.`);

      // Highlight the parameter for user feedback
      this.highlightParameter(this.currentLearnParam);

      // Provide visual feedback to the user
      showUniversalModal(
        'MIDI Learn',
        `Perform a MIDI action (e.g., move a knob) to map it to '${this.currentLearnParam}'.`,
        'Cancel'
      ).then(() => {
        if (this.isMidiLearnModeActive) {
          // User canceled MIDI Learn mode
          this.isMidiLearnModeActive = false;
          this.unhighlightParameter(this.currentLearnParam);
          this.currentLearnParam = null;
          console.log('MIDIController: MIDI Learn mode canceled by user.');
        }
      });
    }

    // Close the context menu
    this.closeContextMenu();
  }

  /**
   * Handles the "Delete" action from the context menu.
   * @param {Event} event 
   */
  handleContextMenuDelete(event) {
    console.log('handleContextMenuDelete called');
    // Prevent default behavior and stop propagation
    event.preventDefault();
    event.stopPropagation();

    if (this.currentlyLearningWidget) {
      const widgetId = this.currentlyLearningWidget.id;
      if (widgetId) {
        this.clearMidiMapping(widgetId);
      } else {
        console.warn("MIDIController: Selected widget does not have a valid 'id' attribute.");
        showUniversalModal(
          'Invalid Widget',
          'The selected widget does not have a valid identifier to delete.',
          'Okay'
        );
      }
      this.closeContextMenu();
    } else if (this.currentLearnParam) {
      this.clearMidiMapping(this.currentLearnParam);
      this.closeContextMenu();
    } else {
      console.warn("MIDIController: No widget or parameter selected to delete MIDI mapping.");
    }
  }

  /**
   * Handles the "Close" action from the context menu.
   * @param {Event} event 
   */
  handleContextMenuClose(event) {
    console.log('handleContextMenuClose called');
    // Prevent default behavior and stop propagation
    event.preventDefault();
    event.stopPropagation();

    this.closeContextMenu();
    console.log("MIDIController: Context menu closed without exiting MIDI Learn mode.");
  }

  isElementMapped(element) {
    const id = element.id || element.getAttribute('data-value');
    return this.midiWidgetMappings.has(id) || this.midiParamMappings.has(id);
  }

  startMidiLearnForElement(element) {
    const id = element.id || element.getAttribute('data-value');
  
    if (!id) {
      console.warn("MIDIController: Element missing 'id' or 'data-value' attribute.");
      return;
    }
  
    if (element.hasAttribute('data-automatable') || element.hasAttribute('data-midi-controllable')) {
      this.currentLearnWidget = element;
      this.highlightWidget(id);
    } else {
      console.warn('MIDIController: Unknown element type:', element);
      return;
    }
  
    this.isMidiLearnModeActive = true;
  
    // Display toast message
    notifications.showToast(`Perform a MIDI action to assign it to '${id}'.`, 'info');
  }

  closeContextMenu() {
    const contextMenu = document.getElementById("midi-context-menu");
    if (contextMenu) {
      contextMenu.classList.remove("show");
      contextMenu.style.display = 'none';
  
      // Re-enable pointer events on the overlay
      if (this.currentlyLearningWidget) {
        const overlay = Array.from(document.querySelectorAll('.widget-overlay')).find(
          ov => ov.dataset.widgetId === this.currentlyLearningWidget.id
        );
        if (overlay) {
          overlay.style.pointerEvents = 'auto';
        }
      }
  
      console.log("MIDIController: Context menu closed.");
      this.currentlyLearningWidget = null;
    }
  }


  /**
   * Opens the MIDI Context Menu for the specified widget or parameter at the event's location.
   * @param {MouseEvent|TouchEvent} e - The event triggering the context menu.
   * @param {HTMLElement} element - The widget or dropdown item requesting MIDI Learn.
   */
  openContextMenu(event, element) {
    event.preventDefault();
    event.stopPropagation();
  
    const contextMenu = document.getElementById('midi-context-menu');
    if (!contextMenu) {
      console.error('MIDIController: Context menu not found.');
      return;
    }
  
    let paramName = null;
  
    if (element.hasAttribute('data-automatable') || element.hasAttribute('data-midi-controllable')) {
      const elementId = element.id || element.getAttribute('data-value');
      if (!elementId) {
        console.warn("MIDIController: Element missing 'id' or 'data-value' attribute.");
        return;
      }
      paramName = elementId;
      this.currentlyLearningWidget = element;
    } else {
      console.warn('MIDIController: Unknown element type:', element);
      return;
    }
  
    // Position and show the context menu
    const rect = element.getBoundingClientRect();
    contextMenu.style.left = `${rect.left}px`;
    contextMenu.style.top = `${rect.bottom}px`;
    contextMenu.style.display = 'block';
    contextMenu.classList.add('show');
    contextMenu.style.zIndex = '1050'; // Ensure context menu is above overlays and Bootstrap dropdowns
  
    // Disable pointer events on the overlay
    const overlay = Array.from(document.querySelectorAll('.widget-overlay')).find(
      ov => ov.dataset.widgetId === element.id
    );
    if (overlay) {
      overlay.style.pointerEvents = 'none';
    }
  
    this.currentLearnParam = paramName;
    console.log(`MIDIController: Opened context menu for parameter '${paramName}'.`);
  }

/**
 * Sets up event listeners for the context menu options.
 */
setupDropdownEventListeners() {
  const contextMenuLearn = document.getElementById("midi-context-learn");
  const contextMenuDelete = document.getElementById("midi-context-delete");
  const contextMenuClose = document.getElementById("midi-context-close");

  // Options for passive event listeners
  const passiveOptions = { passive: true };

  if (contextMenuLearn) {
      contextMenuLearn.addEventListener("click", this.handleContextMenuLearn);
      contextMenuLearn.addEventListener("touchstart", this.handleContextMenuLearn, passiveOptions);
  }

  if (contextMenuDelete) {
      contextMenuDelete.addEventListener("click", this.handleContextMenuDelete);
      contextMenuDelete.addEventListener("touchstart", this.handleContextMenuDelete, passiveOptions);
  }

  if (contextMenuClose) {
      contextMenuClose.addEventListener("click", this.handleContextMenuClose);
      contextMenuClose.addEventListener("touchstart", this.handleContextMenuClose, passiveOptions);
  }

  // Handle closing the context menu when clicking outside
  document.addEventListener('click', (e) => {
      const contextMenu = document.getElementById("midi-context-menu");
      if (contextMenu &amp;&amp; contextMenu.style.display === 'block' &amp;&amp; !contextMenu.contains(e.target)) {
          this.closeContextMenu();
      }
  });

  // Handle escape key to close the context menu
  document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
          this.closeContextMenu();
      }
  });

  console.log("MIDIController: Set up context menu event listeners.");
}


}

export const MIDIControllerInstance = new MIDIController();</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-MIDIControllers.html">MIDIControllers</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="DataManager.html">DataManager</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-namespaces"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="MIDI.html">MIDI</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-global"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#MIDI_SUPPORTED">MIDI_SUPPORTED</a></div><div class="sidebar-section-children"><a href="global.html#_setValue">_setValue</a></div><div class="sidebar-section-children"><a href="global.html#activateRadio">activateRadio</a></div><div class="sidebar-section-children"><a href="global.html#addEventListeners">addEventListeners</a></div><div class="sidebar-section-children"><a href="global.html#animate">animate</a></div><div class="sidebar-section-children"><a href="global.html#applyColorsFromTrackData">applyColorsFromTrackData</a></div><div class="sidebar-section-children"><a href="global.html#cycleState">cycleState</a></div><div class="sidebar-section-children"><a href="global.html#drawKnob">drawKnob</a></div><div class="sidebar-section-children"><a href="global.html#drawModeIndicator">drawModeIndicator</a></div><div class="sidebar-section-children"><a href="global.html#drawSlider">drawSlider</a></div><div class="sidebar-section-children"><a href="global.html#drawSwitch">drawSwitch</a></div><div class="sidebar-section-children"><a href="global.html#forward">forward</a></div><div class="sidebar-section-children"><a href="global.html#getPriority">getPriority</a></div><div class="sidebar-section-children"><a href="global.html#handleParamChange">handleParamChange</a></div><div class="sidebar-section-children"><a href="global.html#hidetip">hidetip</a></div><div class="sidebar-section-children"><a href="global.html#initializeApp">initializeApp</a></div><div class="sidebar-section-children"><a href="global.html#initializeAttributes">initializeAttributes</a></div><div class="sidebar-section-children"><a href="global.html#initializeRootParams">initializeRootParams</a></div><div class="sidebar-section-children"><a href="global.html#inverse">inverse</a></div><div class="sidebar-section-children"><a href="global.html#isActive">isActive</a></div><div class="sidebar-section-children"><a href="global.html#keydown">keydown</a></div><div class="sidebar-section-children"><a href="global.html#linear">linear</a></div><div class="sidebar-section-children"><a href="global.html#loadAndDisplayModel">loadAndDisplayModel</a></div><div class="sidebar-section-children"><a href="global.html#loadGLBModelWithRetry">loadGLBModelWithRetry</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#onParameterChanged">onParameterChanged</a></div><div class="sidebar-section-children"><a href="global.html#piecewiseLinear">piecewiseLinear</a></div><div class="sidebar-section-children"><a href="global.html#pointerdown">pointerdown</a></div><div class="sidebar-section-children"><a href="global.html#pointermove">pointermove</a></div><div class="sidebar-section-children"><a href="global.html#pointerup">pointerup</a></div><div class="sidebar-section-children"><a href="global.html#processColors">processColors</a></div><div class="sidebar-section-children"><a href="global.html#redraw">redraw</a></div><div class="sidebar-section-children"><a href="global.html#registerMenuItemsWithMIDIController">registerMenuItemsWithMIDIController</a></div><div class="sidebar-section-children"><a href="global.html#removeEventListeners">removeEventListeners</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setValue">setValue</a></div><div class="sidebar-section-children"><a href="global.html#setupCanvas">setupCanvas</a></div><div class="sidebar-section-children"><a href="global.html#setupCollapseMenuAlignment">setupCollapseMenuAlignment</a></div><div class="sidebar-section-children"><a href="global.html#setupInteractions">setupInteractions</a></div><div class="sidebar-section-children"><a href="global.html#setupLabel">setupLabel</a></div><div class="sidebar-section-children"><a href="global.html#setupResizeObserver">setupResizeObserver</a></div><div class="sidebar-section-children"><a href="global.html#showParameterSelectionModal">showParameterSelectionModal</a></div><div class="sidebar-section-children"><a href="global.html#showUniversalModal">showUniversalModal</a></div><div class="sidebar-section-children"><a href="global.html#showtip">showtip</a></div><div class="sidebar-section-children"><a href="global.html#toggleState">toggleState</a></div><div class="sidebar-section-children"><a href="global.html#triggerKick">triggerKick</a></div><div class="sidebar-section-children"><a href="global.html#updateKnobsFromTrackData">updateKnobsFromTrackData</a></div><div class="sidebar-section-children"><a href="global.html#updateLinkedParam">updateLinkedParam</a></div><div class="sidebar-section-children"><a href="global.html#updateTooltip">updateTooltip</a></div><div class="sidebar-section-children"><a href="global.html#updateValueFromPointer">updateValueFromPointer</a></div><div class="sidebar-section-children"><a href="global.html#updateValueFromPointerRel">updateValueFromPointerRel</a></div><div class="sidebar-section-children"><a href="global.html#validateValue">validateValue</a></div><div class="sidebar-section-children"><a href="global.html#wheel">wheel</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>